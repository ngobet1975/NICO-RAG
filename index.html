<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>NICO-RAG — Page de démarrage</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header>
    <h1>NICO-RAG</h1>
    <span class="chip">SWA + Entra ID</span>
    <span class="chip">MSAL → API</span>
  </header>

  <div class="grid">
    <section class="card">
      <h2>Identité (/.auth/me)</h2>
      <p>Vous êtes connecté via Microsoft Entra ID. Les infos ci-dessous viennent de <code>/.auth/me</code> (SWA).</p>
      <pre id="me">Chargement…</pre>
      <div class="row">
        <button onclick="location.href='/.auth/logout'">Se déconnecter</button>
        <button class="primary" id="btnReloadMe">Rafraîchir</button>
      </div>
    </section>

    <section class="card">
      <h2>Appel API protégé</h2>
      <p>La SPA obtient un jeton via <strong>MSAL</strong> et appelle l'API sur <code>/health</code>.</p>
      <div class="row">
        <button class="primary" id="btnCall">Tester l’appel API</button>
        <button id="btnClear">Nettoyer</button>
      </div>
      <pre id="api">En attente…</pre>
    </section>
  </div>

  <section class="card" style="margin-top:16px">
    <h2>Chat Azure OpenAI</h2>
    <p>Cette zone envoie vos messages à l’API (<code>/chat</code>) avec un jeton MSAL.</p>
    <div id="chatLog"></div>
    <div class="row" style="margin-top:10px">
      <input id="chatInput" placeholder="Posez une question (ex : « Mon agenda cette semaine ? »)"/>
      <button id="sendBtn">Envoyer</button>
      <button id="clearChat">Effacer</button>
    </div>
  </section>

  <footer>
    POC France Central · SWA authentifiée · API App Service protégée
  </footer>

  <script type="module" src="/main.js"></script>
</body>
</html>
